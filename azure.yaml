# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: aca-ai-agent
metadata:
  template: aca-ai-agent@0.0.1-beta
hooks:
  postup:
    run: |
      env
      az storage file upload --account-name $STORAGE_ACCOUNT_NAME --share-name pdfs --source sample-data/contoso-roles.pdf --path contoso-roles.pdf
      az storage file upload --account-name $STORAGE_ACCOUNT_NAME --share-name pdfs --source sample-data/employee_handbook.pdf --path employee_handbook.pdf

      az acr build -r $ACR_NAME -t chat-app:1.0 src

      az containerapp update -n chat-app -g $RESOURCE_GROUP_NAME --image "$ACR_NAME.azurecr.io/chat-app:1.0"
      az containerapp job update -n indexer-job -g $RESOURCE_GROUP_NAME --image "$ACR_NAME.azurecr.io/chat-app:1.0"